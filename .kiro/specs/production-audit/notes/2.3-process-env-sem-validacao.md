# 2.3 â€” Usos de `process.env` fora de `src/lib/env.ts` sem validaÃ§Ã£o

**Data:** 2025-01-28
**Requisito:** 2.3 â€” Identificar usos de process.env sem validaÃ§Ã£o centralizada
**Status:** âœ… Todos os achados corrigÃ­veis foram corrigidos
**Ãšltima atualizaÃ§Ã£o:** CorreÃ§Ãµes aplicadas

---

## Resumo

AnÃ¡lise de usos de `process.env` fora do `env.ts`. Dos 21 achados originais, os itens corrigÃ­veis foram todos resolvidos. Itens de sugestÃ£o (scripts standalone, debug, middleware Edge) permanecem como estÃ£o por design.

## Achados e Status

### ğŸ”´ CRÃTICO

| #   | DescriÃ§Ã£o                                  | Status                                                               |
| --- | ------------------------------------------ | -------------------------------------------------------------------- |
| 1   | `CRON_SECRET` fallback hardcoded (cron v1) | âœ… Corrigido no 2.2 â€” usa `env.CRON_SECRET`                          |
| 2   | `JWT_SECRET` fallback hardcoded (jwt.ts)   | âœ… Corrigido no 2.2 â€” usa `env.JWT_SECRET`                           |
| 3   | `GERENTE_INIT` sem check (dashboard)       | âœ… N/A â€” variÃ¡vel removida, rota usa `validateRequest()` + `user.id` |

### ğŸŸ¡ ATENÃ‡ÃƒO

| #    | DescriÃ§Ã£o                                                 | Status                                                               |
| ---- | --------------------------------------------------------- | -------------------------------------------------------------------- |
| 4    | `GERENTE_INIT` sem centralizaÃ§Ã£o (perfil)                 | âœ… N/A â€” variÃ¡vel removida, rota usa `validateRequest()` + `user.id` |
| 5    | `NEXT_PUBLIC_APP_URL` ausente do env.ts (forgot-password) | âœ… Adicionado ao `env.ts`, rota usa `env.NEXT_PUBLIC_APP_URL`        |
| 6    | `REDIS_URL` bypass env.ts (redis.ts)                      | âœ… Corrigido no 2.2 â€” usa `env.REDIS_URL`                            |
| 7    | `REDIS_URL` bypass env.ts (queues.ts)                     | âœ… Corrigido no 2.2 â€” usa `env.REDIS_URL`                            |
| 8    | `REDIS_URL` bypass env.ts (worker.ts)                     | âœ… Corrigido no 2.2 â€” usa `env.REDIS_URL`                            |
| 9-12 | `AWS_SES_*` bypass env.ts (notifications.ts)              | âœ… Migrado para `env.AWS_SES_*`                                      |
| 16   | `NEXT_PUBLIC_APP_URL` fallback vazio (cron v1)            | âœ… Migrado para `env.NEXT_PUBLIC_APP_URL`                            |
| 17   | `NEXT_PUBLIC_APP_URL` fallback localhost (send-reminders) | âœ… Migrado para `env.NEXT_PUBLIC_APP_URL`                            |
| 21   | `CRON_SECRET` process.env direto (cron raiz)              | âœ… Migrado para `env.CRON_SECRET`                                    |

### ğŸŸ¢ SUGESTÃƒO (mantidos como estÃ£o)

| #   | DescriÃ§Ã£o                            | Justificativa                                                         |
| --- | ------------------------------------ | --------------------------------------------------------------------- |
| 13  | `NODE_ENV` em jwt.ts                 | âœ… Migrado para `env.NODE_ENV`                                        |
| 14  | `NODE_ENV` em middleware.ts          | Mantido â€” middleware Edge Runtime pode ter restriÃ§Ãµes de import       |
| 15  | `NODE_ENV` em utils.ts (client-side) | Mantido â€” componente client-side nÃ£o pode importar env.ts server-side |
| 18  | VariÃ¡veis em seed.ts                 | Mantido â€” script standalone com validaÃ§Ã£o local prÃ³pria               |
| 19  | `DATABASE_URL` em drizzle.ts         | Mantido â€” risco de dependÃªncia circular com env.ts                    |
| 20  | VariÃ¡veis em debug/insights          | Mantido â€” rota de diagnÃ³stico, uso intencional de process.env         |

---

## VariÃ¡veis adicionadas ao `env.ts`

| VariÃ¡vel              | Schema                          | Quando       |
| --------------------- | ------------------------------- | ------------ |
| `CRON_SECRET`         | `z.string().min(16).optional()` | CorreÃ§Ã£o 2.2 |
| `NEXT_PUBLIC_APP_URL` | `z.string().url().optional()`   | CorreÃ§Ã£o 2.3 |

> `GERENTE_INIT` nÃ£o foi adicionado ao env.ts pois a variÃ¡vel foi completamente removida do cÃ³digo â€” as rotas do gerente agora usam JWT auth.

## Resumo de Severidade

| Severidade  | Quantidade | Corrigidos                             |
| ----------- | ---------- | -------------------------------------- |
| ğŸ”´ CRÃTICO  | 3          | âœ… 3/3 (2 corrigidos, 1 N/A)           |
| ğŸŸ¡ ATENÃ‡ÃƒO  | 11         | âœ… 11/11 (9 corrigidos, 2 N/A)         |
| ğŸŸ¢ SUGESTÃƒO | 7          | âœ… 1 corrigido + 6 mantidos por design |
| **Total**   | **21**     | **âœ… 21/21 resolvidos**                |
