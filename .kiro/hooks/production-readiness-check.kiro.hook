{
  "enabled": true,
  "name": "Preparador para Produ√ß√£o",
  "description": "Analisa o codebase em busca de bugs, vulnerabilidades de seguran√ßa, riscos de custos altos (queries pesadas, chamadas externas sem controle) e pontos de quebra do sistema antes do deploy para produ√ß√£o.",
  "version": "1",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Fa√ßa uma auditoria completa do projeto para prepara√ß√£o de produ√ß√£o. Analise os seguintes pontos cr√≠ticos e gere um relat√≥rio detalhado em portugu√™s (pt-BR):\n\n## 1. BUGS E ERROS\n- Procure por catch blocks vazios (sem tratamento de erro)\n- Verifique uso de `any` no TypeScript que pode esconder bugs\n- Identifique vari√°veis que podem ser null/undefined sem verifica√ß√£o\n- Procure por promises sem await ou sem .catch()\n- Verifique race conditions em webhooks e opera√ß√µes ass√≠ncronas\n- Identifique imports quebrados ou depend√™ncias circulares\n\n## 2. RISCOS DE SEGURAN√áA\n- Verifique se TODAS as rotas protegidas usam `validateRequest()` do JWT\n- Procure por dados sens√≠veis expostos em logs (senhas, tokens, chaves API)\n- Verifique se inputs de API t√™m valida√ß√£o Zod\n- Identifique endpoints sem rate limiting\n- Verifique se uploads validam tipo e tamanho antes do S3\n- Procure por SQL injection ou queries sem sanitiza√ß√£o\n- Verifique se headers de seguran√ßa est√£o configurados no middleware\n- Identifique secrets hardcoded no c√≥digo\n- Verifique se vari√°veis de ambiente cr√≠ticas s√£o validadas na inicializa√ß√£o\n\n## 3. RISCOS DE CUSTOS ALTOS\n- Identifique queries ao banco sem .limit() que podem retornar milhares de registros\n- Procure por chamadas √† API Cielo sem controle de idempot√™ncia (risco de cobran√ßas duplicadas)\n- Verifique se h√° loops que fazem chamadas HTTP ou queries ao banco (N+1 problem)\n- Identifique uploads ao S3 sem valida√ß√£o de tamanho\n- Procure por envio de emails/WhatsApp sem deduplica√ß√£o\n- Verifique se cron jobs podem executar em paralelo causando duplica√ß√£o\n- Identifique cache misses que podem sobrecarregar o banco\n\n## 4. RISCOS DE QUEBRA DO SISTEMA\n- Verifique se h√° opera√ß√µes sem timeout (fetch, conex√µes externas)\n- Procure por uso de AbortSignal.timeout() incompat√≠vel com Edge Runtime\n- Identifique pontos √∫nicos de falha (single points of failure)\n- Verifique se transa√ß√µes de banco s√£o at√¥micas onde necess√°rio\n- Procure por memory leaks potenciais (event listeners n√£o removidos, buffers grandes)\n- Verifique se o middleware trata erros corretamente sem derrubar o app\n- Identifique depend√™ncias de servi√ßos externos sem fallback (Redis, S3, Cielo, Evolution API)\n\n## FORMATO DO RELAT√ìRIO\nPara cada problema encontrado, liste:\n- üî¥ CR√çTICO / üü° ATEN√á√ÉO / üü¢ SUGEST√ÉO\n- Arquivo e linha\n- Descri√ß√£o do problema\n- Impacto potencial\n- Sugest√£o de corre√ß√£o\n\nAo final, d√™ uma nota de 0-10 para a prontid√£o de produ√ß√£o e liste as 5 a√ß√µes mais urgentes."
  }
}